---
title: "Hawaii Plant METE Results Log"
author: "A. J. Rominger"
date: "February 27, 2017"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

## function to color code deviations from theory, also useful for state variable plotting
fitCol <- function(x) {
    m <- 1/(max(x, na.rm = TRUE) - min(x, na.rm = TRUE))
    
    newx <- m * (x - min(x, na.rm = TRUE))
    
    colval <- colorRamp(hsv(c(0.17, 0.6), c(0.5, 1), c(1, 0.7)))(newx)
    colval[is.na(colval)] <- 0
    
    col <- rgb(colval, maxColorValue = 255)
    col[col == '#000000'] <- 'transparent'
    
    return(col)
}
```

Setup workspace and load data
```{r}
library(socorro)
library(meteR)
library(sp)
setwd('~/Dropbox/Research/hawaiiMETE_plant')

load('meteSumm.RData')
```

First look at how deviations from METE play out across the islands. Fit is based on $z^2$ values as discussed in Rominger and Merow MEE paper.
```{r}
plot(meteSumm, col = fitCol(sqrt(meteSumm@data$z2SAD)), pch = 16, cex = 0.5)
```

Looking explicitly across variables of interest
```{r}
plot(meteSumm@data[, c('age_mid', 'z2SAD')], log = 'x')
plot(meteSumm@data[, c('MAP', 'z2SAD')], log = 'x')
plot(meteSumm@data[, c('MAT', 'z2SAD')], log = 'x')
```



Looking now jointly at environment and age as predictors of deviation
layout(matrix(2:1, nrow = 2), heights = c(1, 4))
par(mar = c(3, 3, 0, 0) + 0.5, mgp = c(2, 0.75, 0))
plot(meteSumm@data[, c('age_mid', 'MAP')], log = 'x', pch = 16, cex = 0.5, 
     col = fitCol(sqrt(meteSumm@data$z2SAD)))
par(mar = c(0, 3, 0, 0) + 0.5, mgp = c(2, 0.75, 0))
plot(sort(meteSumm@data$z2SAD), col = fitCol(sort(sqrt(meteSumm@data$z2SAD))), 
     pch = 16, cex = 0.5, ylab = 'z^2 value', xaxt = 'n')






plot(meteSumm@data[, c('S0', 'z2SAD')])
plot(meteSumm@data[, c('N0', 'z2SAD')], log = 'x')
plot(meteSumm@data[, c('E0', 'z2SAD')], log = 'x')
plot(meteSumm@data[, c('Prop_Introduced', 'z2SAD')])

pairs(meteSumm@data[, c('S0', 'N0', 'E0')], log = 'xy')

plot(meteSumm@data[, c('max_PlotArea', 'z2SAD')], log = 'x')
plot(meteSumm@data[, c('max_PlotArea', 'S0')], log = 'xy')
plot(meteSumm@data[, c('max_PlotArea', 'N0')], log = 'xy')
plot(meteSumm@data[, c('max_PlotArea', 'E0')], log = 'xy')

plot(meteSumm@data[, c('age_mid', 'z2SAD')], log = 'x')
plot(meteSumm@data[, c('age_mid', 'S0')], log = 'xy')
plot(meteSumm@data[, c('age_mid', 'N0')], log = 'xy')
plot(meteSumm@data[, c('age_mid', 'E0')], log = 'xy')


layout(matrix(2:1, nrow = 2), heights = c(1, 4))
par(mar = c(3, 3, 0, 0) + 0.5, mgp = c(2, 0.75, 0))
plot(meteSumm@data[, c('age_mid', 'max_PlotArea')], log = 'xy', pch = 16, cex = 1, 
     col = fitCol(sqrt(meteSumm@data$z2SAD)))
par(mar = c(0, 3, 0, 0) + 0.5, mgp = c(2, 0.75, 0))
plot(sort(meteSumm@data$z2SAD), col = fitCol(sort(sqrt(meteSumm@data$z2SAD))), 
     pch = 16, cex = 0.5, ylab = 'z^2 value', xaxt = 'n')

layout(matrix(2:1, nrow = 2), heights = c(1, 4))
par(mar = c(3, 3, 0, 0) + 0.5, mgp = c(2, 0.75, 0))
plot(meteSumm@data[, c('age_mid', 'max_PlotArea')], log = 'xy', pch = 16, cex = 1, 
     col = fitCol(log(meteSumm@data$S0)))
par(mar = c(0, 3, 0, 0) + 0.5, mgp = c(2, 0.75, 0))
plot(sort(meteSumm@data$S0), col = fitCol(sort(log(meteSumm@data$S0))), 
     pch = 16, cex = 0.5, ylab = 'S0', xaxt = 'n', log = 'y')


par(mfrow = c(4, 4), mar = c(2, 2, 0, 0), oma = c(2, 2, 0.5, 0.5), 
    mgp = c(1.5, 0.3, 0), tcl = -0.25)
for(i in sample(which(!is.na(meteSumm@data$z2SAD)), prod(par('mfrow')))) {
    plot(meteSADIPD[[i]]$sad, ptype = 'rad', add.legend = FALSE, 
         xlab = '', ylab = '', log = 'y', ylim = c(1, max(meteSADIPD[[i]]$sad$data)))
}
mtext('Rank', side = 1, outer = TRUE)
mtext('Abundance', side = 2, outer = TRUE)
